services:
  briar-mysql:
    image: mysql:9.0.1
    container_name: mysqlimg
    build:
      context: .
      dockerfile: Dockerfile.mysql
    ports:
      - '33060:33060'
    environment:
      - MYSQL_ALLOW_EMPTY_PASSWORD=yes
      - MYSQL_ROOT_PASSWORD=123456
    volumes:
      - briar-mysql-data:/var/lib/mysql
  briar-node:
    image: zhangleilaoge/briar-node
    build:
      context: .
      dockerfile: Dockerfile.node
    container_name: nodeimg
    volumes:
      - briar-static:/briar-mono/packages/briar-frontend/dist
    ports:
      - '8922:8922'
    depends_on:
      - briar-mysql
  briar-nginx:
    image: zhangleilaoge/briar-nginx
    build:
      context: .
      dockerfile: Dockerfile.nginx
    container_name: nginximg
    volumes:
      - briar-static:/usr/share/nginx/static
    ports:
      - '443:443'
      - '80:80'
    depends_on:
      - briar-node
volumes:
  briar-static:
  briar-mysql-data:
    # driver: local
    # driver_opts:
    #   type: none
    #   device: 'C:/Program Files/MySQL/MySQL Server 9.0/data'
    #   o: bind
