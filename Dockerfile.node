FROM node:16-alpine AS build
WORKDIR /briar-mono
COPY . .

RUN npm install -g pnpm@8.15.9
RUN pnpm install
RUN pnpm run build
RUN pnpm run cdn
# 清理 pnpm 缓存
RUN pnpm store prune

FROM node:16-alpine
WORKDIR /briar-mono
COPY --from=build /briar-mono/packages/briar-frontend/dist /briar-mono/packages/briar-frontend/dist
EXPOSE 8922
CMD ["pnpm", "run", "start"]
